var canvasUtils_prototype=function(){"use strict";!function(t){var n;t._getCtx=function(){if(!n){var t=document.createElement("canvas");n=t.getContext("2d")}return n},t.calcObjSizes=function(t){for(var n=this.createIteratorFor(t.words),e=null;e=n.next();){var i=this.textLength(e.text+" ",t);e.w=i,e.h=t.fontSize}return t},t.createIteratorFor=function(t){var n=0,e=0,i={start:function(){n=0,e=0},next:function(){var r=t[n];if(!r)return null;if(r.length<=e)return n++,e=0,i.next();var a=e++;return r[a]},prev:function(){if(0>=e)return 0>=n?null:(n--,e=t[n].length,i.prev());var r=t[n];return e--,r[e]}};return i},t.fontStyleString=function(t){var n=Math.floor(t.fontSize)+"px "+t.fontFamily;return t.italic&&(n="italic "+n),t.bold&&(n="bold "+n),n},t.prepareLines=function(t){var n=this.createIteratorFor(t.words);t._lines=[],t._lineHeight=[],t._lineCnt=0;var e=t.w,i=(t.h,0),r=0,a=0,o=0,l=0,s=(t.lineStep||4,t.wordStep||0),f=function(n){l=0,r=0,i=0;for(var f=null,c=function(n,e,i){t._lines[n]?i&&(t._lines[n].length=0):t._lines[n]=[],t._lines[n].push(e)};f=n.next();){if(0==l)f.h>a&&(a=f.h),c(i,f,!0),r+=f.w+s,f._lineIndex=i,f._total=r,t._lineCnt=i+1,l++;else{var h=r+f.w+s;h>=e?(l=1,i++,c(i,f,!0),r=f.w+s,o+=a,f._total=r,f._lineIndex=i,t._lineCnt=i+1):(r+=f.w+s,f._lineIndex=i,f._total=r,c(i,f),t._lineCnt=i+1,l++)}f._newline&&(l=0,i++,r=0,o+=a)}for(var _=0;_<t._lineCnt;_++)t._lineHeight[_]=0;for(n.start();f=n.next();){var _=f._lineIndex;t._lineHeight[_]<f.h&&(t._lineHeight[_]=f.h)}};f(n)},t.renderPage=function(t,n,e){var i=t._lineCnt,r=0,a=0,o=5;t.x&&(r+=t.x),t.y&&(r+=t.y),t.lineStep&&(o=t.lineStep);var l=r;e?(n.textBaseline("bottom"),n.font(this.fontStyleString(t))):(n.textBaseline="bottom",n.font=this.fontStyleString(t));for(var s=0;i>s;s++){var f=t._lineHeight[s],c=t._lines[s];r=l;var h=0;"center"==t.align&&(r+=(t.w-c[c.length-1]._total)/2),"right"==t.align&&(r+=t.w-c[c.length-1]._total),"fill"==t.align&&c.length>1&&(h=(t.w-c[c.length-1]._total)/(c.length-1)),h>.2*t.width&&(h=0),s==i-1&&(h=0);for(var _=0;_<c.length;_++){var u=c[_];n.fillText(u.text,r,a+f),n.strokeText(u.text,r,a+f),r+=u.w+h}a+=t._lineHeight[s]+o}},t.renderText=function(t,n,e){{var i=this.txtToObjs(t,n);this.calcObjSizes(i)}this.prepareLines(i),this.renderPage(i,e)},t.renderText2=function(t,n,e){{var i=this.txtToObjs(t,n);this.calcObjSizes(i)}this.prepareLines(i),this.renderPage(i,e,!0)},t.textLength=function(t,n){var e=this._getCtx();return e.font=this.fontStyleString(n),e.measureText(t).width},t.txtToObjs=function(t,n){var e=t.split("\n");return n||(n={words:[]}),n.words||(n.words=[]),n.words.length=0,e.forEach(function(t){var e=t.split(" "),i=[],r=0;if(e.forEach(function(t){var n=t;if(n.length>0){var e={text:n,_i:r++};i.push(e)}}),0==i.length){var a={text:"",_i:r++};i.push(a)}i.length>0&&(i[r-1]._newline=!0,n.words.push(i))}),n}}(this),function(t){t.drawBox=function(t,n,e,i,r,a,o){t.beginPath(),t.rect(n,e,i,r),t.closePath(),a&&(t.fillStyle=a,t.fill()),o&&(t.strokeStyle=o,t.stroke())},t.drawCircle=function(t,n,e,i){t.beginPath(),t.arc(n,e,i,0,2*Math.PI,!1),t.closePath()},t.drawDashedLine=function(t,n,e,i,r,a,o){o||(o=.5),a||(a=10);var l=(1-o)*a,s=o*a,f=i-n,c=r-e,h=Math.sqrt(f*f+c*c),_=f/h;j=c/h;for(var u=n,v=e;h>0&&(s>h&&(s=h),this.drawLine(t,u,v,u+_*s,v+j*s),u+=_*s,v+=j*s,h-=s,!(0>=h));)u+=_*l,v+=j*l,h-=l},t.drawLine=function(t,n,e,i,r){t.beginPath(),t.moveTo(n,e),t.lineTo(i,r),t.stroke()}}(this),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},canvasUtils=function(t,n,e,i,r,a,o,l){if(!(this instanceof canvasUtils))return new canvasUtils(t,n,e,i,r,a,o,l);var s=[t,n,e,i,r,a,o,l];if(this.__factoryClass){var f,c=this;if(this.__factoryClass.forEach(function(t){f=t.apply(c,s)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=canvasUtils._classInfo.name)return new f(t,n,e,i,r,a,o,l)}else if(f)return f}if(this.__traitInit){var c=this;this.__traitInit.forEach(function(t){t.apply(c,s)})}else"function"==typeof this.init&&this.init.apply(this,s)};canvasUtils._classInfo={name:"canvasUtils"},canvasUtils.prototype=new canvasUtils_prototype,"undefined"!=typeof window&&(window.canvasUtils=canvasUtils),"undefined"!=typeof window&&(window.canvasUtils_prototype=canvasUtils_prototype);