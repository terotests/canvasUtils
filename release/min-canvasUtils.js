var canvasUtils_prototype=function(){"use strict";!function(t){var n;t._getCtx=function(){if(!n){var t=document.createElement("canvas");n=t.getContext("2d")}return n},t.calcObjSizes=function(t){for(var n=this.createIteratorFor(t.words),e=null;e=n.next();){var i=this.textLength(e.text+" ",t);e.w=i,e.h=t.fontSize}return t},t.createIteratorFor=function(t){var n=0,e=0,i={start:function(){n=0,e=0},next:function(){var r=t[n];if(!r)return null;if(r.length<=e)return n++,e=0,i.next();var a=e++;return r[a]},prev:function(){if(0>=e)return 0>=n?null:(n--,e=t[n].length,i.prev());var r=t[n];return e--,r[e]}};return i},t.fontStyleString=function(t){var n=Math.floor(t.fontSize)+"px "+t.fontFamily;return t.italic&&(n="italic "+n),t.bold&&(n="bold "+n),n},t.prepareLines=function(t){var n=this.createIteratorFor(t.words);t._lines=[],t._lineHeight=[],t._lineCnt=0,t._hOverFlow=0;var e=t.w,i=(t.h,0),r=0,a=0,o=0,l=0,s=(t.lineStep||4,t.wordStep||0),h=function(n){l=0,r=0,i=0;for(var h=null,f=function(n,e,i){t._lines[n]?i&&(t._lines[n].length=0):t._lines[n]=[],t._lines[n].push(e)};h=n.next();){if(0==l)h.h>a&&(a=h.h),f(i,h,!0),r+=h.w+s,r>t.w&&(t._hOverFlow=r-t.w),h._lineIndex=i,h._total=r,t._lineCnt=i+1,l++;else{var c=r+h.w+s;c>=e?(l=1,i++,f(i,h,!0),r=h.w+s,r>t.w&&(t._hOverFlow=r-t.w),o+=a,h._total=r,h._lineIndex=i,t._lineCnt=i+1):(r+=h.w+s,h._lineIndex=i,h._total=r,f(i,h),t._lineCnt=i+1,l++)}h._newline&&(l=0,i++,r=0,o+=a)}for(var _=0;_<t._lineCnt;_++)t._lineHeight[_]=0;for(n.start();h=n.next();){var _=h._lineIndex;t._lineHeight[_]<h.h&&(t._lineHeight[_]=h.h)}};h(n);for(var f=0,c=0;c<t._lineCnt;c++)f+=t._lineHeight[c];return f+=(t.lineStep||5)*t._lineCnt},t.renderPage=function(t,n,e){var i=t._lineCnt,r=0,a=0,o=5;t.x&&(r+=t.x),t.y&&(r+=t.y),t.lineStep&&(o=t.lineStep);var l=r;e?(n.textBaseline("bottom"),n.font(this.fontStyleString(t))):(n.textBaseline="bottom",n.font=this.fontStyleString(t));for(var s=0;i>s;s++){var h=t._lineHeight[s],f=t._lines[s];r=l;var c=0;"center"==t.align&&(r+=(t.w-f[f.length-1]._total)/2),"right"==t.align&&(r+=t.w-f[f.length-1]._total),"fill"==t.align&&f.length>1&&(c=(t.w-f[f.length-1]._total)/(f.length-1)),c>.2*t.width&&(c=0),s==i-1&&(c=0),f.length>0&&f[f.length-1]._newline&&(c=0);for(var _=0;_<f.length;_++){var u=f[_];n.fillText(u.text,r,a+h),n.strokeText(u.text,r,a+h),r+=u.w+c}a+=t._lineHeight[s]+o}},t.renderText=function(t,n,e){var i=this.txtToObjs(t,n),r=(this.calcObjSizes(i),n.fontSize);if(n.fitToPage){var a=10,o=0,l=4,s=t.length,h=this.prepareLines(i),f=r,c=1,_=Math.sqrt(n.w*n.h/s),u=this,v=function(t){f=t,i.fontSize=f,u.calcObjSizes(i),h=u.prepareLines(i),o=h-n.h};for(v(_);a>0&&Math.abs(o)>1;){var w=Math.sqrt(n.w*h/s);l||(l=Math.abs(w-_)),n.h<h?f-=l*c:f+=l*c,v(f),a--,c-=.04}for(a=20;a>0&&o>=0;)f-=1,v(f),a--;i._hOverFlow&&(i.fontSize=.9*f*(i.w/(i.w+i._hOverFlow)),this.calcObjSizes(i),h=this.prepareLines(i)),o=h-n.h}else this.prepareLines(i);this.renderPage(i,e),i.fontSize=r},t.renderText2=function(t,n,e){{var i=this.txtToObjs(t,n);this.calcObjSizes(i)}this.prepareLines(i),this.renderPage(i,e,!0)},t.textLength=function(t,n){var e=this._getCtx();return e.font=this.fontStyleString(n),e.measureText(t).width},t.txtToObjs=function(t,n){var e=t.split("\n");return n||(n={words:[]}),n.words||(n.words=[]),n.words.length=0,e.forEach(function(t){var e=t.split(" "),i=[],r=0;if(e.forEach(function(t){var n=t;if(n.length>0){var e={text:n,_i:r++};i.push(e)}}),0==i.length){var a={text:"",_i:r++};i.push(a)}i.length>0&&(i[r-1]._newline=!0,n.words.push(i))}),n}}(this),function(t){t.drawBox=function(t,n,e,i,r,a,o){t.beginPath(),t.rect(n,e,i,r),t.closePath(),a&&(t.fillStyle=a,t.fill()),o&&(t.strokeStyle=o,t.stroke())},t.drawCircle=function(t,n,e,i){t.beginPath(),t.arc(n,e,i,0,2*Math.PI,!1),t.closePath()},t.drawDashedLine=function(t,n,e,i,r,a,o){o||(o=.5),a||(a=10);var l=(1-o)*a,s=o*a,h=i-n,f=r-e,c=Math.sqrt(h*h+f*f),_=h/c;j=f/c;for(var u=n,v=e;c>0&&(s>c&&(s=c),this.drawLine(t,u,v,u+_*s,v+j*s),u+=_*s,v+=j*s,c-=s,!(0>=c));)u+=_*l,v+=j*l,c-=l},t.drawLine=function(t,n,e,i,r){t.beginPath(),t.moveTo(n,e),t.lineTo(i,r),t.stroke()}}(this),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},canvasUtils=function(t,n,e,i,r,a,o,l){if(!(this instanceof canvasUtils))return new canvasUtils(t,n,e,i,r,a,o,l);var s=[t,n,e,i,r,a,o,l];if(this.__factoryClass){var h,f=this;if(this.__factoryClass.forEach(function(t){h=t.apply(f,s)}),"[object Function]"==Object.prototype.toString.call(h)){if(h._classInfo.name!=canvasUtils._classInfo.name)return new h(t,n,e,i,r,a,o,l)}else if(h)return h}if(this.__traitInit){var f=this;this.__traitInit.forEach(function(t){t.apply(f,s)})}else"function"==typeof this.init&&this.init.apply(this,s)};canvasUtils._classInfo={name:"canvasUtils"},canvasUtils.prototype=new canvasUtils_prototype,"undefined"!=typeof window&&(window.canvasUtils=canvasUtils),"undefined"!=typeof window&&(window.canvasUtils_prototype=canvasUtils_prototype);